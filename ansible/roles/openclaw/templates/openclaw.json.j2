{% set default_models = {
  "anthropic": "anthropic/claude-opus-4-6",
  "openai": "openai/gpt-4o",
  "do_ai": "do-ai/llama-3.3-70b-instruct",
  "gemini": "google/gemini-2.0-flash",
  "openrouter": "anthropic/claude-sonnet-4-5",
  "gradient": "gradient/llama-3.1-8b",
} %}
{% set has_providers = llm_providers | length > 0 %}
{% set provider_models = [] %}
{% for p in llm_providers %}
{% set model_id = p.model or default_models.get(p.name, '') %}
{% if model_id %}
{% set _ = provider_models.append(model_id) %}
{% endif %}
{% endfor %}
{
  "agents": {
    "defaults": {
{% if has_providers %}
{% set primary = llm_providers[0] %}
      "model": {
        "primary": "{{ primary.model or default_models.get(primary.name, '') }}"{{ ',' if provider_models | length > 1 else '' }}
{% if provider_models | length > 1 %}
        "fallback": [
{% for model_id in provider_models[1:] %}
          "{{ model_id }}"{{ ',' if not loop.last else '' }}
{% endfor %}
        ]
{% endif %}
      }
{% else %}
      "model": {
        "primary": "anthropic/claude-opus-4-6"
      }
{% endif %}
{% if sandbox_mode != "off" %}
      ,
      "sandbox": {
        "mode": "{{ sandbox_mode }}",
        "scope": "{{ sandbox_scope | default('session') }}",
        "workspaceAccess": "none"
      }
{% endif %}
    }
  },
{% if llm_providers | selectattr('name', 'equalto', 'do_ai') | list | length > 0 %}
  "models": {
    "mode": "merge",
    "providers": {
      "do-ai": {
        "baseUrl": "https://inference.do-ai.run/v1",
        "apiKey": "${DO_AI_API_KEY}",
        "api": "openai-completions",
        "models": [
          { "id": "llama-3.3-70b-instruct", "name": "Llama 3.3 70B", "contextWindow": 128000, "maxTokens": 8192 },
          { "id": "deepseek-r1-distill-llama-70b", "name": "DeepSeek R1 70B", "reasoning": true, "contextWindow": 128000, "maxTokens": 8192 }
        ]
      }
    }
  },
{% endif %}
  "gateway": {
    "port": 18789,
    "mode": "local",
{% if access_method == "https" %}
    "trustedProxies": ["127.0.0.1/8", "172.16.0.0/12"],
{% endif %}
    "auth": {
      "mode": "token",
      "token": "{{ _gateway_token }}"
    },
    "controlUi": {
      "enabled": {{ enable_control_ui | default(true) | lower }},
      "basePath": "/openclaw"
    }
  },
{% set _extra_channels = openclaw_channels | default([]) | reject('equalto', 'telegram') | list %}
{% set _has_telegram = telegram_bot_token != "" or 'telegram' in openclaw_channels | default([]) %}
{% set _channels = (['telegram'] if _has_telegram else []) + _extra_channels %}
{% if _channels | length > 0 %}
  "channels": {
{% for channel in _channels %}
{% if channel == 'telegram' and telegram_bot_token != "" %}
    "{{ channel }}": {
      "enabled": true,
      "botToken": "{{ telegram_bot_token }}",
      "dmPolicy": "{{ telegram_dm_policy }}"
    }{{ ',' if not loop.last else '' }}
{% else %}
    "{{ channel }}": {
      "enabled": true,
      "dmPolicy": "pairing"
    }{{ ',' if not loop.last else '' }}
{% endif %}
{% endfor %}
  },
{% endif %}
{% if enable_browser | default(false) | bool %}
  "browser": {
    "enabled": true,
    "executablePath": "/usr/bin/google-chrome-stable",
    "headless": true,
    "noSandbox": true,
    "defaultProfile": "openclaw"
  },
{% endif %}
{% if brave_api_key | default('') != '' %}
  "tools": {
    "web": {
      "search": {
        "enabled": true,
        "maxResults": 5
      }
    }
  },
{% endif %}
  "commands": {
    "native": "auto",
    "nativeSkills": "auto"
  }
}
